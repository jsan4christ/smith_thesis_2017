plot_expected<-ggplot()+geom_line(data=cnr,aes(x=purity,y=lratio,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
geom_line(data=cnr,aes(x=purity,y=upperbound,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
scale_colour_manual(values = c("0"="#f1a340","1"="#a6dba0","2"="#998ec3"))+
geom_point(data=filter(bioinformatic_dilution,region=="RB1"),aes(x=purity,y=log2,pch=`CDKN2A Status`),size=3)+
theme_bw()+xlab("Tumor purity")+ylab("log2 read ratio (tumor/normal)")+
theme(text = element_text(size=16))+
guides(lty = guide_legend(title = "Ploidy"),col=guide_legend(title = "CNA"))+
geom_hline(yintercept = c(-0.75,-1),col='grey',size=2)+
ggtitle("Expected and observed log2 ratios of CDKN2A reads")+
annotate('text', x = 0.85, y = 0.9,
label = "log2(purityxCNA/ploidy + (1-purity)) ",parse = TRUE)
plot(plot_expected)
plot_expected<-ggplot()+geom_line(data=cnr,aes(x=purity,y=lratio,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
geom_line(data=cnr,aes(x=purity,y=upperbound,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
geom_line(data=cnr,aes(x=purity,y=lowerbound,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
scale_colour_manual(values = c("0"="#f1a340","1"="#a6dba0","2"="#998ec3"))+
geom_point(data=filter(bioinformatic_dilution,region=="RB1"),aes(x=purity,y=log2,pch=`CDKN2A Status`),size=3)+
theme_bw()+xlab("Tumor purity")+ylab("log2 read ratio (tumor/normal)")+
theme(text = element_text(size=16))+
guides(lty = guide_legend(title = "Ploidy"),col=guide_legend(title = "CNA"))+
geom_hline(yintercept = c(-0.75,-1),col='grey',size=2)+
ggtitle("Expected and observed log2 ratios of CDKN2A reads")+
annotate('text', x = 0.85, y = 0.9,
label = "log2(purityxCNA/ploidy + (1-purity)) ",parse = TRUE)
plot(plot_expected)
log(.85,2)
log(.85,2)/log(.7,2)
p<-ggplot()+geom_line(data=filter(cnr,CNV %in% c(0,1) & ploidy==2),aes(x=purity,y=lratio,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
theme_bw()+xlab("Tumor purity")+ylab("log2 read ratio (tumor/normal)")+
theme(text = element_text(size=16))+
guides(lty = guide_legend(title = "Ploidy"),col=guide_legend(title = "CNA"))+
geom_hline(yintercept = c(-0.5,-1),col='grey',size=2)+
geom_point(data=clinical_CDKN2A,aes(x=pathpurity/100,y=log2,col=ddpcr),size=3,pch=15)+
geom_line(data=cnr,aes(x=purity,y=upperbound,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
geom_line(data=cnr,aes(x=purity,y=lowerbound,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)
gh<-ggplot(data=clinical_CDKN2A,aes(x=log2))+
geom_histogram(bins = 35,size=2)+
coord_flip()+theme_bw()+
geom_vline(xintercept = c(-0.5,-1),col='grey')+
xlab("")+
theme(axis.text.y = element_blank(),text = element_text(size=16))+
ylab("Number clinical cases")
point_hist<-grid.arrange(p,gh,ncol=2,widths=c(3,1))
ddpcr_results<-read.table(paste0(root_dir,"ddpcr_results.txt"),header = T,sep = "\t")
ddpcr_results$ddpcr<-"ddpcr"
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = 1,intercept = 0)
ddpcr_results[ddpcr_results$ddpcr_log2>0 & ddpcr_results$cnvkit_log2 < (-1),]
intersect(clinical_CDKN2A$sample,ddpcr_results$sample)
ddpcr_results<-read.table(paste0(root_dir,"ddpcr_results.txt"),header = T,sep = "\t")
ddpcr_results$ddpcr<-"ddpcr"
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = 1,intercept = 0)
ddpcr_results[ddpcr_results$ddpcr_log2>0 & ddpcr_results$cnvkit_log2 < (-1),]
intersect(clinical_CDKN2A$sample,ddpcr_results$sample)
clinical_CDKN2A<-merge(ddpcr_results,clinical_CDKN2A,all.y=T)
p<-ggplot()+geom_line(data=filter(cnr,CNV %in% c(0,1) & ploidy==2),aes(x=purity,y=lratio,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
theme_bw()+xlab("Tumor purity")+ylab("log2 read ratio (tumor/normal)")+
theme(text = element_text(size=16))+
guides(lty = guide_legend(title = "Ploidy"),col=guide_legend(title = "CNA"))+
geom_hline(yintercept = c(-0.5,-1),col='grey',size=2)+
geom_point(data=clinical_CDKN2A,aes(x=pathpurity/100,y=log2,col=ddpcr),size=3,pch=15)+
geom_line(data=cnr,aes(x=purity,y=upperbound,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
geom_line(data=cnr,aes(x=purity,y=lowerbound,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)
gh<-ggplot(data=clinical_CDKN2A,aes(x=log2))+
geom_histogram(bins = 35,size=2)+
coord_flip()+theme_bw()+
geom_vline(xintercept = c(-0.5,-1),col='grey')+
xlab("")+
theme(axis.text.y = element_blank(),text = element_text(size=16))+
ylab("Number clinical cases")
point_hist<-grid.arrange(p,gh,ncol=2,widths=c(3,1))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = 1,intercept = 0)
p
log(0.7,2)/(log(.3/2 + .7,2))
1.194667/3.194667
cnr$upperbound<-cnr$lratio-cnr$lratio*.373
cnr$lowerbound<-cnr$lratio+cnr$lratio*.373
clinical_CDKN2A<-filter(bp.greg,gene %in% "CDKN2A")
clinical_CDKN2A[clinical_CDKN2A$log2<(-5),"log2"]<--4.5
plot_expected<-ggplot()+geom_line(data=cnr,aes(x=purity,y=lratio,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
geom_line(data=cnr,aes(x=purity,y=upperbound,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
geom_line(data=cnr,aes(x=purity,y=lowerbound,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
scale_colour_manual(values = c("0"="#f1a340","1"="#a6dba0","2"="#998ec3"))+
geom_point(data=filter(bioinformatic_dilution,region=="RB1"),aes(x=purity,y=log2,pch=`CDKN2A Status`),size=3)+
theme_bw()+xlab("Tumor purity")+ylab("log2 read ratio (tumor/normal)")+
theme(text = element_text(size=16))+
guides(lty = guide_legend(title = "Ploidy"),col=guide_legend(title = "CNA"))+
geom_hline(yintercept = c(-0.75,-1),col='grey',size=2)+
ggtitle("Expected and observed log2 ratios of CDKN2A reads")+
annotate('text', x = 0.85, y = 0.9,
label = "log2(purityxCNA/ploidy + (1-purity)) ",parse = TRUE)
plot(plot_expected)
cnr
ddpcr_results<-read.table(paste0(root_dir,"ddpcr_results.txt"),header = T,sep = "\t")
ddpcr_results$ddpcr<-"ddpcr"
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = 1,intercept = 0)
ddpcr_results[ddpcr_results$ddpcr_log2>0 & ddpcr_results$cnvkit_log2 < (-1),]
intersect(clinical_CDKN2A$sample,ddpcr_results$sample)
clinical_CDKN2A<-merge(ddpcr_results,clinical_CDKN2A,all.y=T)
p<-ggplot()+geom_line(data=filter(cnr,CNV %in% c(0,1) & ploidy==2),aes(x=purity,y=lratio,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
theme_bw()+xlab("Tumor purity")+ylab("log2 read ratio (tumor/normal)")+
theme(text = element_text(size=16))+
guides(lty = guide_legend(title = "Ploidy"),col=guide_legend(title = "CNA"))+
geom_hline(yintercept = c(-0.5,-1),col='grey',size=2)+
geom_point(data=clinical_CDKN2A,aes(x=pathpurity/100,y=log2,col=ddpcr),size=3,pch=15)+
geom_line(data=cnr,aes(x=purity,y=upperbound,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
geom_line(data=cnr,aes(x=purity,y=lowerbound,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)
gh<-ggplot(data=clinical_CDKN2A,aes(x=log2))+
geom_histogram(bins = 35,size=2)+
coord_flip()+theme_bw()+
geom_vline(xintercept = c(-0.5,-1),col='grey')+
xlab("")+
theme(axis.text.y = element_blank(),text = element_text(size=16))+
ylab("Number clinical cases")
point_hist<-grid.arrange(p,gh,ncol=2,widths=c(3,1))
.68/3
(1-.68/2)
.68/2
.68
1-.34
1-.37
ddpcr_results$cnvkit_log2 < (1-.34)*log(ddpcr_results$pathpurity)
ddpcr_results[ddpcr_results$cnvkit_log2 < (1-.34)*log(ddpcr_results$pathpurity),]
ddpcr_results[ddpcr_results$cnvkit_log2 < (1-.34)*log(ddpcr_results$pathpurity),c("cnvkit_log2","ddpcr_log2")]
ddpcr_results[ddpcr_results$cnvkit_log2 < (1-.34)*log(ddpcr_results$pathpurity),c("pathpurity","cnvkit_log2","ddpcr_log2")]
plot(ddpcr_results[ddpcr_results$cnvkit_log2 < (1-.34)*log(ddpcr_results$pathpurity),c("pathpurity","cnvkit_log2","ddpcr_log2")])
plot(ddpcr_results[ddpcr_results$cnvkit_log2 > (1-.34)*log(ddpcr_results$pathpurity),c("pathpurity","cnvkit_log2","ddpcr_log2")])
log(ddpcr_results$pathpurity,2)
log((1-ddpcr_results$pathpurity),2)
(1-ddpcr_results$pathpurity)
log((1-ddpcr_results$pathpurity/100),2)
plot(ddpcr_results[ddpcr_results$cnvkit_log2 < (1-.34)*log((1-ddpcr_results$pathpurity/100),2),c("pathpurity","cnvkit_log2","ddpcr_log2")])
plot(ddpcr_results[ddpcr_results$cnvkit_log2 > (1-.34)*log((1-ddpcr_results$pathpurity/100),2),c("pathpurity","cnvkit_log2","ddpcr_log2")])
plot(ddpcr_results[ddpcr_results$cnvkit_log2 < (1-.34)*log((1-ddpcr_results$pathpurity/100),2),c("pathpurity","cnvkit_log2","ddpcr_log2")])
grepl(clinical_CDKN2A$sample,pattern =  "PGDX10169")
sum(grepl(clinical_CDKN2A$sample,pattern =  "PGDX10169"))
sum(grepl(cnr$sample,pattern =  "PGDX10169"))
cnr
sum(grepl(bp.greg$sample,pattern =  "PGDX10169"))
bp.greg$sample
filter(bp.greg,sample== "PGDX10169")
bp.greg[bp.greg,grepl(bp.greg$sample== "PGDX10169"),]
bp.greg[grepl(bp.greg$sample== "PGDX10169"),]
bp.greg[grepl(bp.greg$sample,pattern = "PGDX10169"),]
bp.greg[grepl(bp.greg$sample,pattern = "PGDX10741"),]
bp.greg[grepl(bp.greg$sample,pattern = "PGDX10741") & (bp.greg$gene=="CDKN2A",]
bp.greg$sample==
intersect(clinical_CDKN2A$sample,ddpcr_results$sample)
clinical_CDKN2A<-merge(ddpcr_results,clinical_CDKN2A,all.y=T)
p<-ggplot()+geom_line(data=filter(cnr,CNV %in% c(0,1) & ploidy==2),aes(x=purity,y=lratio,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
theme_bw()+xlab("Tumor purity")+ylab("log2 read ratio (tumor/normal)")+
theme(text = element_text(size=16))+
guides(lty = guide_legend(title = "Ploidy"),col=guide_legend(title = "CNA"))+
geom_hline(yintercept = c(-0.5,-1),col='grey',size=2)+
geom_point(data=clinical_CDKN2A,aes(x=pathpurity/100,y=log2,col=ddpcr),size=3,pch=15)+
geom_line(data=cnr,aes(x=purity,y=upperbound,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
geom_line(data=cnr,aes(x=purity,y=lowerbound,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)
gh<-ggplot(data=clinical_CDKN2A,aes(x=log2))+
geom_histogram(bins = 35,size=2)+
coord_flip()+theme_bw()+
geom_vline(xintercept = c(-0.5,-1),col='grey')+
xlab("")+
theme(axis.text.y = element_blank(),text = element_text(size=16))+
ylab("Number clinical cases")
point_hist<-grid.arrange(p,gh,ncol=2,widths=c(3,1))
ggsave(point_hist,filename = "plot_Blueprint_backtest.ps",device = "ps",path = root_dir)
sum(nrow(filter(clinical_CDKN2A,pathpurity>=.3 & log2<(-.5))))/nrow(clinical_CDKN2A)
sum(nrow(filter(clinical_CDKN2A,pathpurity>=.3 & log2<(-1))))/nrow(clinical_CDKN2A)
```
bp.greg[grepl(bp.greg$sample,pattern = "PGDX10741") & bp.greg$gene=="CDKN2A",]
bp.greg[grepl(bp.greg$sample,pattern = "PGDX11137") ,]
bp.greg[bp.greg$log2 <(-2) ,]
bp.greg[bp.greg$log2 <(-2) & bp.greg$pathpurity>60 ,]
bp.greg[bp.greg$log2 <(-2) & bp.greg$pathpurity>60 & bp.greg$gene=="CDKN2A",]
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = 1,intercept = 0)
nrow(ddpcr_results)
nrow(ddpcr_results[!is.na(ddpcr_results$sample),]
ddpcr_results<-read.table(paste0(root_dir,"ddpcr_results.txt"),header = T,sep = "\t")
ddpcr_results$ddpcr<-"ddpcr"
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = 1,intercept = 0)+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 100 back-tested CP6 samples")
ddpcr_results[ddpcr_results$cnvkit_log2 < (1-.34)*log((1-ddpcr_results$pathpurity/100),2),c("pathpurity","cnvkit_log2","ddpcr_log2")]
bp.greg[grepl(bp.greg$sample,pattern = "PGDX11137") ,]
bp.greg[bp.greg$log2 <(-2) & bp.greg$pathpurity>60 & bp.greg$gene=="CDKN2A",]
intersect(clinical_CDKN2A$sample,ddpcr_results$sample)
clinical_CDKN2A<-merge(ddpcr_results,clinical_CDKN2A,all.y=T)
p<-ggplot()+geom_line(data=filter(cnr,CNV %in% c(0,1) & ploidy==2),aes(x=purity,y=lratio,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
theme_bw()+xlab("Tumor purity")+ylab("log2 read ratio (tumor/normal)")+
theme(text = element_text(size=16))+
guides(lty = guide_legend(title = "Ploidy"),col=guide_legend(title = "CNA"))+
geom_hline(yintercept = c(-0.5,-1),col='grey',size=2)+
geom_point(data=clinical_CDKN2A,aes(x=pathpurity/100,y=log2,col=ddpcr),size=3,pch=15)+
geom_line(data=cnr,aes(x=purity,y=upperbound,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)+
geom_line(data=cnr,aes(x=purity,y=lowerbound,col=as.factor(CNV),lty=as.factor(ploidy)),size=1.1)
gh<-ggplot(data=clinical_CDKN2A,aes(x=log2))+
geom_histogram(bins = 35,size=2)+
coord_flip()+theme_bw()+
geom_vline(xintercept = c(-0.5,-1),col='grey')+
xlab("")+
theme(axis.text.y = element_blank(),text = element_text(size=16))+
ylab("Number clinical cases")
point_hist<-grid.arrange(p,gh,ncol=2,widths=c(3,1))
ggsave(point_hist,filename = "plot_Blueprint_backtest.ps",device = "ps",path = root_dir)
sum(nrow(filter(clinical_CDKN2A,pathpurity>=.3 & log2<(-.5))))/nrow(clinical_CDKN2A)
sum(nrow(filter(clinical_CDKN2A,pathpurity>=.3 & log2<(-1))))/nrow(clinical_CDKN2A)
```
nrow(ddpcr_results[!is.na(ddpcr_results$sample),])
ddpcr_results
nrow(ddpcr_results[!is.na(ddpcr_results$ddpcr_log2),])
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = 1,intercept = 0)+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = 1,intercept = 0,lty=1)+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = 1,intercept = 0,lty=2)+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")
lm(x = ddpcr_results$ddpcr_log2,ddpcr_results$cnvkit_log2)
lm(x = ddpcr_results$ddpcr_log2,ddpcr_results$cnvkit_log2,formula = cnvkit_log2~ddpcr_log2)
lm(data=ddpcr_log2,formula = cnvkit_log2~ddpcr_log2)
lm(data=ddpcr_results,formula = cnvkit_log2~ddpcr_log2)
linear_fit.ddpcr<-lm(data=ddpcr_results,formula = cnvkit_log2~ddpcr_log2)
linear_fit.ddpcr$coefficients
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = c(1,2),intercept = 0,lty=2)+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")
linear_fit.ddpcr$coefficients[2]
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=2)+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")
(linear_fit.ddpcr<-lm(data=ddpcr_results,formula = cnvkit_log2~ddpcr_log2))
summary(linear_fit.ddpcr)
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R2=0.7")
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7",parse=T)
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7",parse=F)
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()
visual_outliers<-c("PGDX10169_T_U_Cp6_20170304_083401",
"PGDX10741_T_U_Cp6_20170411_194515",
"PGDX11137_T_U_Cp6_20170527_154128",
"PGDX11300_T_U_Cp6_20170617_114929",
"PGDX11271_T_U_Cp6_20170615_111243")
ddpcr_results[ddpcr_results$sample %in% visual_outliers,"visual_outliers"]<-"visual_outlier"
ddpcr_results[!ddpcr_results$sample %in% visual_outliers,"visual_outliers"]<-"concordant"
ddpcr_results[ddpcr_results$sample %in% visual_outliers,"visual_outliers"]<-"disconcordant"
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=visual_outliers))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=visual_outliers))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=visual_outliers))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()+fill_manual(values = c("concordant"='black',"disconcordant"='red'))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=visual_outliers))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
postscript(paste0(root,"ddpcr_concordance.ps"))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=visual_outliers))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
dev.off()
paste0(root,"ddpcr_concordance.ps")
postscript(paste0(root_dir,"ddpcr_concordance.ps"))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=visual_outliers))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
dev.off()
.66*log(.3,2)
.66*log(.3,2)
.66*log(.7,2)
1.33 * log(.3/2 + .7,2)
(1-0.33)*log(0.7,2)
1.33 *log(0.3/2 + (1-0.3),2)
(1-0.34)*log(0.7,2)
1.33 *log(0.3/2 + (1-0.3),2)
1.34 *log(0.3/2 + (1-0.3),2)
(1-0.33)*log(0.7,2)
(1+0.33)*log(0.3/2 + (1-0.3),2)
(1-0.33)*log((1-0.3),2)
(1+0.33)*log((0.3/2) + (1-0.3),2)
(1-0.4)*log((1-0.3),2)
(1+0.4)*log((0.3/2) + (1-0.3),2)
(1-0.347)*log((1-0.3),2)
(1+0.347)*log((0.3/2) + (1-0.3),2)
(1-0.373)*log((1-0.3),2)
(1+0.373)*log((0.3/2) + (1-0.3),2)
0.373*2
68/2
(1-0.373)*log((1-0.3),2)
(1+0.373)*log((0.3/2) + (1-0.3),2)
(1-0.34)*log((1-0.3),2)
(1+0.34)*log((0.3/2) + (1-0.3),2)
(1-0.34)*(1-clinical_CDKN2A$pathpurity)
clinical_CDKN2A$log2 < (1-0.34)*(1-clinical_CDKN2A$pathpurity)
clinical_CDKN2A$pathpurity
clinical_CDKN2A$pathpurity>30 & clinical_CDKN2A$log2 < (1-0.34)*(1-clinical_CDKN2A$pathpurity/100)
clinical_CDKN2A[clinical_CDKN2A$pathpurity>30 & clinical_CDKN2A$log2 < (1-0.34)*(1-clinical_CDKN2A$pathpurity/100),]
clinical_CDKN2A[!is.na(clinical_CDKN2A$sample) & clinical_CDKN2A$pathpurity>30 & clinical_CDKN2A$log2 < (1-0.34)*(1-clinical_CDKN2A$pathpurity/100),]
!is.na(clinical_CDKN2A$sample)
clinical_CDKN2A<-clinical_CDKN2A[!is.na(clinical_CDKN2A$sample) ]
clinical_CDKN2A[!is.na(clinical_CDKN2A$sample) & clinical_CDKN2A$pathpurity>30 & clinical_CDKN2A$log2 < (1-0.34)*(1-clinical_CDKN2A$pathpurity/100),]
clinical_CDKN2A[!is.na(clinical_CDKN2A$sample) & clinical_CDKN2A$pathpurity>30 & clinical_CDKN2A$log2 < (1-0.34)*(1-clinical_CDKN2A$pathpurity/100),]
clinical_CDKN2A<-clinical_CDKN2A[!is.na(clinical_CDKN2A$sample) ]
clinical_CDKN2A
clinical_CDKN2A<-clinical_CDKN2A[!is.na(clinical_CDKN2A$sample), ]
clinical_CDKN2A
clinical_CDKN2A[!is.na(clinical_CDKN2A$sample) & clinical_CDKN2A$pathpurity>30 & clinical_CDKN2A$log2 < (1-0.34)*(1-clinical_CDKN2A$pathpurity/100),]
clinical_CDKN2A[!is.na(clinical_CDKN2A$sample)
]
clinical_CDKN2A[!is.na(clinical_CDKN2A$sample), ]
clinical_CDKN2A$pathpurity>30 & clinical_CDKN2A$log2 < (1-0.34)*(1-clinical_CDKN2A$pathpurity/100)
clinical_CDKN2A<-clinical_CDKN2A[!is.na(clinical_CDKN2A$pathpurity), ]
clinical_CDKN2A[!is.na(clinical_CDKN2A$sample) & clinical_CDKN2A$pathpurity>30 & clinical_CDKN2A$log2 < (1-0.34)*(1-clinical_CDKN2A$pathpurity/100),]
clinical_CDKN2A[!is.na(clinical_CDKN2A$sample) & clinical_CDKN2A$pathpurity>30 & clinical_CDKN2A$log2 < (1-0.34)*(1-clinical_CDKN2A$pathpurity/100),]
clinical_CDKN2A[!is.na(clinical_CDKN2A$sample) & clinical_CDKN2A$pathpurity>30 & clinical_CDKN2A$log2 < (1-0.34)*(1-clinical_CDKN2A$pathpurity/100),]/nrow(clinical_CDKN2A[!is.na(clinical_CDKN2A$sample) & clinical_CDKN2A$pathpurity>30,])
clinical_CDKN2A[ clinical_CDKN2A$pathpurity>30,]
nrow(clinical_CDKN2A[ clinical_CDKN2A$pathpurity>30,])
clinical_CDKN2A[!is.na(clinical_CDKN2A$sample) & clinical_CDKN2A$pathpurity>30 & clinical_CDKN2A$log2 < (1-0.34)*(1-clinical_CDKN2A$pathpurity/100),
]
clinical_CDKN2A[!is.na(clinical_CDKN2A$sample) & clinical_CDKN2A$pathpurity>30 & clinical_CDKN2A$log2 < (1-0.34)*(1-clinical_CDKN2A$pathpurity/100),]/nrow(clinical_CDKN2A[ clinical_CDKN2A$pathpurity>30,])
clinical_CDKN2A[!is.na(clinical_CDKN2A$sample) & clinical_CDKN2A$pathpurity>30 & clinical_CDKN2A$log2 < (1-0.34)*(1-clinical_CDKN2A$pathpurity/100),]
nrow(clinical_CDKN2A[!is.na(clinical_CDKN2A$sample) & clinical_CDKN2A$pathpurity>30 & clinical_CDKN2A$log2 < (1-0.34)*(1-clinical_CDKN2A$pathpurity/100),])/
nrow(clinical_CDKN2A[ clinical_CDKN2A$pathpurity>30,])
point_hist<-grid.arrange(p,gh,ncol=2,widths=c(3,1))
clinical_CDKN2A$pathpurity>=80 & clinical_CDKN2A$cnvkit_log2 < (-1)
clinical_CDKN2A$pathpurity
clinical_CDKN2A$cnvkit_log2
clinical_CDKN2A$log2
clinical_CDKN2A$pathpurity>=80 & clinical_CDKN2A$log2 < (-1)& clinical_CDKN2A$log2 > (-2)
clinical_CDKN2A[clinical_CDKN2A$pathpurity>=80 & clinical_CDKN2A$log2 < (-1)& clinical_CDKN2A$log2 > (-2),]
clinical_CDKN2A[clinical_CDKN2A$pathpurity>=80 & clinical_CDKN2A$log2 < (-1)& clinical_CDKN2A$log2 > (-2),"sample"]
clinical_CDKN2A[clinical_CDKN2A$pathpurity>=80 & clinical_CDKN2A$log2 < (-1)& clinical_CDKN2A$log2 > (-2),"sample"]
write.csv(clinical_CDKN2A[clinical_CDKN2A$pathpurity>=80 & clinical_CDKN2A$log2 < (-1)& clinical_CDKN2A$log2 > (-2),"sample"],file = "~/sample.csv")
grepl(clinical_CDKN2A$sample,pattern = "PGDX10256T")
clinical_CDKN2A[grepl(clinical_CDKN2A$sample,pattern = "PGDX10256T"),]
clinical_CDKN2A[grepl(clinical_CDKN2A$sample,pattern = "PGDX10256"),]
clinical_CDKN2A[clinical_CDKN2A$pathpurity>=80 & clinical_CDKN2A$log2 < (-1)& clinical_CDKN2A$log2 > (-2),]
ddpcr_results
bp.greg$log2 > .5
bp.greg[bp.greg$log2 > .5 ,]
bp.greg[bp.greg$log2 > .5  & bp.greg$gene=="CDKN2A",]
clinical_CDKN2A[clinical_CDKN2A$pathpurity>=80 & clinical_CDKN2A$log2 < (-1)& clinical_CDKN2A$log2 > (-2),]
clinical_CDKN2A[clinical_CDKN2A$pathpurity>=80 & clinical_CDKN2A$log2 > (0),]
clinical_CDKN2A[clinical_CDKN2A$pathpurity>=80 & clinical_CDKN2A$log2 < (-1)& clinical_CDKN2A$log2 > (-2),]
55719142.2857143/(55719142.2857143+130011332)
32502833/(32502833+130011332)
32502833/(32502833+130011332)
13929785.5714286/(13929785.5714286+32502833)
228716.967741936/(228716.967741936+28360904)
grey<-read.table("~/Documents/blueprint/grey",header = T,sep = "\t")
hist(grey$log2)
grey$log2
grey<-read.table("~/Documents/blueprint/grey",header = T,sep = "\t",stringsAsFactors = F)
grey<-read.table("~/Documents/blueprint/grey",header = T,sep = "\t",stringsAsFactors = F)
hist(grey$log2)
grey$log2
as.numeric(grey$log2)
grey$log2<-as.numeric(grey$log2)
hist(grey$log2)
hist(bp.greg$log2)
ggplot(bp.greg,aes(x=$log2))+geom_histogram()
ggplot(bp.greg,aes(x=log2))+geom_histogram()
clinical_CDKN2A[clinical_CDKN2A$pathpurity>=80 & clinical_CDKN2A$log2 < (-1)& clinical_CDKN2A$log2 > (-2),"grey"]<-"grey"
bp.greg[bp.greg$pathpurity>=80 & bp.greg$log2 < (-1)& bp.greg$log2 > (-2),"grey"]<-"grey"
bp.greg$log2
bp.greg[bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2),"grey"]
bp.greg$pathpurity>=80
bp.greg[bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2),]
bp.greg[bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2),"grey"]<-"grey"
bp.greg[!is.na(bp.greg$pathpurity) & bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2),"grey"]<-"grey"
ggplot(bp.greg,aes(x=log2))+geom_histogram()+facet_wrap(~grey)
ggplot(bp.greg,aes(x=log2))+geom_histogram()+facet_wrap(~grey,scales = "freey_y")
ggplot(bp.greg,aes(x=log2))+geom_histogram()+facet_wrap(~grey,scales = "free_y")
ggplot(bp.greg,aes(x=log2))+geom_histogram()+facet_wrap(~grey,scales = "free_y",ncol=1)
ggplot(bp.greg,aes(x=log2,fill=grey))+geom_histogram()#+facet_wrap(~grey,scales = "free_y",ncol=1)
ggplot(bp.greg,aes(x=log2,fill=grey,bins=20))+geom_histogram()#+facet_wrap(~grey,scales = "free_y",ncol=1)
ggplot(bp.greg,aes(x=log2,fill=grey))+geom_histogram(bins=20)#+facet_wrap(~grey,scales = "free_y",ncol=1)
ggplot(bp.greg,aes(x=log2,fill=grey))+geom_histogram(bins=2)#+facet_wrap(~grey,scales = "free_y",ncol=1)
ggplot(bp.greg,aes(x=log2,fill=grey))+geom_histogram(bins=15)#+facet_wrap(~grey,scales = "free_y",ncol=1)
ggplot(bp.greg,aes(x=log2,fill=grey))+geom_histogram(bins=7)#+facet_wrap(~grey,scales = "free_y",ncol=1)
ggplot(bp.greg,aes(x=log2,fill=grey))+geom_histogram(bins=50)#+facet_wrap(~grey,scales = "free_y",ncol=1)
ggplot(bp.greg,aes(x=log2,fill=grey))+geom_histogram(bins=100)#+facet_wrap(~grey,scales = "free_y",ncol=1)
ggplot(bp.greg,aes(x=log2,fill=grey))+geom_histogram(bins=80)#+facet_wrap(~grey,scales = "free_y",ncol=1)
ggplot(bp.greg,aes(x=log2,fill=grey))+geom_histogram(bins=90)#+facet_wrap(~grey,scales = "free_y",ncol=1)
mean(bp.greg$log2)
mean(bp.greg[!is.na(bp.greg$pathpurity) & bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2),"log2"])
t.test(bp.greg$log2,bp.greg[!is.na(bp.greg$pathpurity) & bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2),"log2"])
bp.greg[!is.na(bp.greg$pathpurity) & bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2),"log2"]
bp.greg$log2
nrow(bp.greg)
bp.greg[!is.na(bp.greg$pathpurity) & bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2),"log2"]
bp.greg[sample(1:nrow(bp.greg), 350,
replace=FALSE),]
bp.greg[sample(1:nrow(bp.greg), 350,
replace=FALSE),"log2"]
t.test(bp.greg[sample(1:nrow(bp.greg), 350,
replace=FALSE),"log2"],bp.greg[!is.na(bp.greg$pathpurity) & bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2),"log2"])
bp.greg[!is.na(bp.greg$pathpurity) & bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2),
]
bp.greg[!is.na(bp.greg$pathpurity) & !(bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2)),"log2"]
non_grey<-bp.greg[!is.na(bp.greg$pathpurity) & !(bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2)),"log2"]
grey<-bp.greg[!is.na(bp.greg$pathpurity) & bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2),"log2"]
length(non_grey)
length(grey)
nrow(bp.greg)
length(non_grey)+length(grey)
nrow(bp.greg[!is.na(bp.greg$pathpurity),])
non_grey[sample(1:length(non_grey), length(grey),
replace=FALSE),]
length(grey)
sample(1:length(non_grey), length(grey),
replace=FALSE)
non_grey[sample(1:length(non_grey), length(grey),
replace=FALSE)]
non_grey.ds<-non_grey[sample(1:length(non_grey), length(grey),
replace=FALSE)]
t.test(non_grey.ds,grey)
hist(non_grey.ds)
plot()
hist(grey)
bp.greg[!is.na(bp.greg$pathpurity) & bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2) & bp.greg$gene=="CDKN2","sample"]
bp.greg[!is.na(bp.greg$pathpurity) & bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2) & bp.greg$gene=="CDKN2A",]
bp.greg[!is.na(bp.greg$pathpurity) & bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2) & bp.greg$gene=="CDKN2A","sample"]
grey_samples<-bp.greg[!is.na(bp.greg$pathpurity) & bp.greg$pathpurity>=80 & bp.greg$log2 < (-1) & bp.greg$log2 > (-2) & bp.greg$gene=="CDKN2A","sample"]
bp.greg$sample %in% grey_samples
bp.greg[bp.greg$sample %in% grey_samples & !bp.greg$gene=="CDKN2A","log2"]
grey<-bp.greg[bp.greg$sample %in% grey_samples & !bp.greg$gene=="CDKN2A","log2"]
non_grey<-bp.greg[!bp.greg$sample %in% grey_samples & !bp.greg$gene=="CDKN2A","log2"]
non_grey
length(non_grey)+length(grey)
non_grey
grey
length(non_grey)
length(grey)
non_grey.ds<-non_grey[sample(1:length(non_grey), length(grey),
replace=FALSE)]
t.test(non_grey.ds,grey)
hist(non_grey.ds)
hist(grey)
hist(non_grey.ds)
hist(grey)
non_grey
ggplot(rbind(data.frame(log2=non_grey,source="non_grey")),col=source)+geom_histogram(bins=40)
rbind(data.frame(log2=non_grey,source="non_grey"))
ggplot(rbind(data.frame(log2=non_grey,source="non_grey")),col=source,aes(x=log2))+geom_histogram(bins=40)
ggplot(rbind(data.frame(log2=grey,source="grey"),data.frame(log2=non_grey.ds,source="non_grey")),col=source,aes(x=log2))+geom_histogram(bins=40)
ggplot(rbind(data.frame(log2=grey,source="grey"),data.frame(log2=non_grey.ds,source="non_grey")),fill=source,aes(x=log2))+geom_histogram(bins=40)
ggplot(rbind(data.frame(log2=grey,source="grey"),data.frame(log2=non_grey.ds,source="non_grey")),aes(fill=source,x=log2))+geom_histogram(bins=40)
ggplot(rbind(data.frame(log2=grey,source="grey"),data.frame(log2=non_grey.ds,source="non_grey")),aes(fill=source,x=log2))+geom_density(bins=40)
ggplot(rbind(data.frame(log2=grey,source="grey"),data.frame(log2=non_grey.ds,source="non_grey")),aes(fill=source,x=log2))+geom_density(bins=40,alpha=.4)
t.test(non_grey,grey)
grey_samples
write.csv(grey_samples,"~/Documents/blueprint/ambiguous_sample_list.csv",row.names = F,quote = F)
split_panel<-split(CP6_panel,ceiling(seq_along(CP6_panel)/floor(length(CP6_panel)/3)))
for(i in 1:3){
#i<-1
bp.greg.inpanel<-filter(bp.greg,gene %in% unlist(split_panel[i]))
cnr[cnr$lratio==-Inf,"lratio"]<-(-4.5)
bp.greg.inpanel[bp.greg.inpanel$log2<(-5),"log2"]<-(-4.5)
p1<-ggplot()+geom_line(data=filter(cnr,CNV %in% c(0) & ploidy==2),aes(x=purity*100,y=lratio))+
geom_point(data=bp.greg.inpanel,aes(x=pathpurity,y=log2))+geom_point(data=bp.greg.inpanel[bp.greg.inpanel$log2<(-1),],aes(x=pathpurity,y=log2,col='red'))+facet_wrap(~gene,scales = "free_y",nrow = ceiling(sqrt(floor(length(CP6_panel)/3))))+
ggtitle("log2 ratios vs path purity, with 'deleted' calls in red")
plot(p1)
}
plot(p1)
log(1+0.001-bp.greg.inpanel$pathpurity,2)
log(1+0.001-bp.greg.inpanel$pathpurity/100,2)
p1<-ggplot()+geom_line(data=filter(cnr,CNV %in% c(0) & ploidy==2),aes(x=purity*100,y=lratio))+
geom_point(data=bp.greg.inpanel,aes(x=pathpurity,y=log2))+geom_point(data=bp.greg.inpanel[bp.greg.inpanel$log2<log(1+0.001-bp.greg.inpanel$pathpurity/100,2),],aes(x=pathpurity,y=log2,col='red'))+facet_wrap(~gene,scales = "free_y",nrow = ceiling(sqrt(floor(length(CP6_panel)/3))))+
ggtitle("log2 ratios vs path purity, with 'deleted' calls in red")
plot(p1)
p1<-ggplot()+geom_line(data=filter(cnr,CNV %in% c(0) & ploidy==2),aes(x=purity*100,y=lratio))+
geom_point(data=bp.greg.inpanel,aes(x=pathpurity,y=log2))+geom_point(data=bp.greg.inpanel[bp.greg.inpanel$log2<.66*log(1+0.001-bp.greg.inpanel$pathpurity/100,2),],aes(x=pathpurity,y=log2,col='red'))+facet_wrap(~gene,scales = "free_y",nrow = ceiling(sqrt(floor(length(CP6_panel)/3))))+
ggtitle("log2 ratios vs path purity, with 'deleted' calls in red")
plot(p1)
p1<-ggplot()+geom_line(data=filter(cnr,CNV %in% c(0) & ploidy==2),aes(x=purity*100,y=lratio))+
geom_point(data=bp.greg.inpanel,aes(x=pathpurity,y=log2))+geom_point(data=bp.greg.inpanel[bp.greg.inpanel$log2<.8*log(1+0.001-bp.greg.inpanel$pathpurity/100,2),],aes(x=pathpurity,y=log2,col='red'))+facet_wrap(~gene,scales = "free_y",nrow = ceiling(sqrt(floor(length(CP6_panel)/3))))+
ggtitle("log2 ratios vs path purity, with 'deleted' calls in red")
plot(p1)
ostscript(paste0(root_dir,"plot_Blueprint_allgenes.ps"),width = 10,height = 8)
split_panel<-split(CP6_panel,ceiling(seq_along(CP6_panel)/floor(length(CP6_panel)/3)))
for(i in 1:3){
#i<-1
bp.greg.inpanel<-filter(bp.greg,gene %in% unlist(split_panel[i]))
cnr[cnr$lratio==-Inf,"lratio"]<-(-4.5)
bp.greg.inpanel[bp.greg.inpanel$log2<(-5),"log2"]<-(-4.5)
p1<-ggplot()+geom_line(data=filter(cnr,CNV %in% c(0) & ploidy==2),aes(x=purity*100,y=lratio))+
geom_point(data=bp.greg.inpanel,aes(x=pathpurity,y=log2))+geom_point(data=bp.greg.inpanel[bp.greg.inpanel$log2<.8*log(1+0.001-bp.greg.inpanel$pathpurity/100,2),],aes(x=pathpurity,y=log2,col='red'))+facet_wrap(~gene,scales = "free_y",nrow = ceiling(sqrt(floor(length(CP6_panel)/3))))+
ggtitle("log2 ratios vs path purity, with 'deleted' calls in red (20% uncertatiny")
plot(p1)
}
dev.off()
grey
unique(grey_samples)
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=visual_outliers))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=pathpurity))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=pathpurity))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()+scale_colour_gradientn(colours = terrain.colors(10))#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=pathpurity))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()+scale_colour_gradientn(colours = terrain.colors(7))#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
library(munsell)
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=pathpurity))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()+scale_colour_gradientn(colours = set1.colors(10))#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=pathpurity))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()+scale_colour_gradientn(colours = rainbow(10))#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=pathpurity))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()+scale_colour_gradientn(colours = rainbow(7))#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=pathpurity))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()+scale_colour_gradientn(colours = rainbow(4))#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=pathpurity))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()+scale_colour_gradientn(colours = rainbow(2))#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=pathpurity))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()+scale_colour_gradientn(colours = rainbow(3))#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=pathpurity))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()+scale_colour_gradientn(colours = rainbow(4))#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=pathpurity))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()+scale_colour_gradientn(low='blue',high='red')#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
ggplot(ddpcr_results,aes(ddpcr_log2,cnvkit_log2,col=pathpurity))+geom_point()+geom_abline(slope = c(1,linear_fit.ddpcr$coefficients[2]),intercept = c(0,linear_fit.ddpcr$coefficients[1]),lty=c(2,1))+ggtitle("Concordance bewtween ddPCR and sequencing of CDKN2A in 42 back-tested CP6 samples")+annotate('text',x = -4,y=0,label="R^2=0.7")+theme_bw()+scale_colour_gradientn(colours=c('blue','red'))#+scale_fill_manual(values = c("concordant"='black',"disconcordant"='red'))
(linear_fit.ddpcr<-lm(data=filter(ddpcr_results, !sample %in% visual_outliers),formula = cnvkit_log2~ddpcr_log2))
linear_fit.ddpcr.filter
(linear_fit.ddpcr.filter<-lm(data=filter(ddpcr_results, !sample %in% visual_outliers),formula = cnvkit_log2~ddpcr_log2))
linear_fit.ddpcr.filter
summary(linear_fit.ddpcr.filter)
ddpcr_results<-read.table(paste0(root_dir,"ddpcr_results.txt"),header = T,sep = "\t")
(linear_fit.ddpcr<-lm(data=ddpcr_results,formula = cnvkit_log2~ddpcr_log2))
filter(ddpcr_results, !sample %in% visual_outliers)
ddpcr_results
summary(linear_fit.ddpcr)
summary(linear_fit.ddpcr)
summary(linear_fit.ddpcr.filter)
(linear_fit.ddpcr.filter<-lm(data=filter(ddpcr_results, !sample %in% visual_outliers),formula = cnvkit_log2~ddpcr_log2))
summary(linear_fit.ddpcr)
summary(linear_fit.ddpcr.filter)
ddpcr_results
names(ddpcr_results)
select(ddpcr_results,c(sample,gene,pathpurity,average_fold,normal,normalized_fold,ddpcr_log2,cnvkit_log2))
write.csv(select(ddpcr_results,c(sample,gene,pathpurity,average_fold,normal,normalized_fold,ddpcr_log2,cnvkit_log2)),"~/Documents/blueprint/CS218_JIRA_TICKET.csv",quote=F,row.names=F)
snp
snp<-read.table("~/bin/bubbletree/snp_VCPS0012_T_B_Cp6_20170728_125724",header = T,sep = "\t")
snp
load(system.file("data", "snp.gr.rda", package="BubbleTree"))
snp.gr
?makeRBD
